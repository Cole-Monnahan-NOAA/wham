<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ex 3: Projecting / forecasting random effects â€¢ wham</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Ex 3: Projecting / forecasting random effects">
<meta property="og:description" content="wham">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">wham</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-book"></span>
     
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/index.html">Overview</a>
    </li>
    <li>
      <a href="../articles/ex1_SNEMA_yellowtail_flounder.html">Ex 1: The basics</a>
    </li>
    <li>
      <a href="../articles/ex2_CPI_recruitment_SNEMA_yellowtail.html">Ex 2: Recruitment linked to an environmental covariate (Cold Pool Index)</a>
    </li>
    <li>
      <a href="../articles/ex3_projections.html">Ex 3: Projecting / forecasting random effects</a>
    </li>
    <li>
      <a href="../articles/ex4_selectivity.html">Ex 4: Selectivity with time- and age-varying random effects</a>
    </li>
    <li>
      <a href="../articles/ex5_GSI_M.html">Ex 5: Time-varying natural mortality linked to the Gulf Stream Index</a>
    </li>
    <li>
      <a href="../articles/ex6_NAA.html">Ex 6: Numbers-at-age / survival deviations as random effects</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
<li>
  <a href="https://github.com/timjmiller/wham/">
    <span class="fa fa-github fa-lg"></span>
     
    Source code
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/timjmiller/wham/issues/">
    <span class="fa fa-question-circle-o"></span>
     
    Issues
  </a>
</li>
<li>
  <a href="https://www.fisheries.noaa.gov/contact/timothy-miller-phd">
    <span class="far fa far fa-paper-plane fa-lg"></span>
     
    Contact
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Ex 3: Projecting / forecasting random effects</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/timjmiller/wham/blob/master/vignettes/ex3_projections.Rmd"><code>vignettes/ex3_projections.Rmd</code></a></small>
      <div class="hidden name"><code>ex3_projections.Rmd</code></div>

    </div>

    
    
<p>In this vignette we walk through an example using the <code>wham</code> (WHAM = Woods Hole Assessment Model) package to run a state-space age-structured stock assessment model. WHAM is a generalization of code written for <a href="https://doi.org/10.1139/cjfas-2015-0339">Miller et al. (2016)</a> and <a href="https://onlinelibrary.wiley.com/doi/full/10.1111/fog.12236">Xu et al. (2018)</a>, and in this example we apply WHAM to the same stock, Southern New England / Mid-Atlantic Yellowtail Flounder.</p>
<p>Here we assume you already have <code>wham</code> installed. If not, see the <a href="https://timjmiller.github.io/wham/">Introduction</a>. This is the 3rd <code>wham</code> example, which builds off model <code>m6</code> from <a href="https://timjmiller.github.io/wham/articles/ex2_CPI_recruitment_SNEMA_yellowtail.html">example 2</a>:</p>
<ul>
<li><p>full state-space model (numbers-at-age are random effects for all ages, <code>NAA_re = list(sigma='rec+1',cor='iid')</code>)</p></li>
<li><p>logistic normal age compositions (<code>input$data$age_comp_model_fleets = 5</code> and <code>input$data$age_comp_model_indices = 5</code>)</p></li>
<li><p>Beverton-Holt recruitment (<code>recruit_model = 3</code>)</p></li>
<li><p>Cold Pool Index (CPI) fit as an AR1 process (<code>ecov$process_model = "ar1"</code>)</p></li>
<li><p>CPI has a "controlling" (density-independent mortality, <a href="https://www.sciencedirect.com/science/article/pii/S1385110197000221">Iles and Beverton (1998)</a>) effect on recruitment (<code>ecov$where = "recruit"</code>, <code>ecov$how = 1</code>)</p></li>
</ul>
<p>In example 3, we demonstrate how to project/forecast WHAM models using the <code><a href="../reference/project_wham.html">project_wham()</a></code> function options for handling</p>
<ul>
<li><p>fishing mortality / catch (use last F, use average F, use <span class="math inline">\(F_{SPR}\)</span>, specify F, specify catch) and the</p></li>
<li><p>environmental covariate (continue ecov process, use last ecov, use average ecov, specify ecov).</p></li>
</ul>
<div id="load-data" class="section level2">
<h2 class="hasAnchor">
<a href="#load-data" class="anchor"></a>1. Load data</h2>
<p>Open R and load the <code>wham</code> package:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">wham</span>)</pre></body></html></div>
<p>For a clean, runnable <code>.R</code> script, look at <code>ex3_projections.R</code> in the <code>example_scripts</code> folder of the <code>wham</code> package install:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">wham.dir</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/find.package.html">find.package</a></span>(<span class="st">"wham"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">wham.dir</span>, <span class="st">"example_scripts"</span>)</pre></body></html></div>
<p>You can run this entire example script with:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">write.dir</span> <span class="kw">&lt;-</span> <span class="st">"choose/where/to/save/output"</span> <span class="co"># otherwise will be saved in working directory</span>
<span class="fu"><a href="https://rdrr.io/r/base/source.html">source</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">wham.dir</span>, <span class="st">"example_scripts"</span>, <span class="st">"ex3_projections.R"</span>))</pre></body></html></div>
<p>Let's create a directory for this analysis:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># choose a location to save output, otherwise will be saved in working directory</span>
<span class="no">write.dir</span> <span class="kw">&lt;-</span> <span class="st">"choose/where/to/save/output"</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(<span class="no">write.dir</span>)
<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span>(<span class="no">write.dir</span>)</pre></body></html></div>
<p>We need the same data files as in <a href="https://timjmiller.github.io/wham/articles/ex2_CPI_recruitment_SNEMA_yellowtail.html">example 2</a>. Let's copy <code>ex2_SNEMAYT.dat</code> and <code>CPI.csv</code> to our analysis directory:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">wham.dir</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/find.package.html">find.package</a></span>(<span class="st">"wham"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span>(<span class="kw">from</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">wham.dir</span>,<span class="st">"extdata"</span>,<span class="st">"ex2_SNEMAYT.dat"</span>), <span class="kw">to</span><span class="kw">=</span><span class="no">write.dir</span>, <span class="kw">overwrite</span><span class="kw">=</span><span class="fl">FALSE</span>)
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span>(<span class="kw">from</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">wham.dir</span>,<span class="st">"extdata"</span>,<span class="st">"CPI.csv"</span>), <span class="kw">to</span><span class="kw">=</span><span class="no">write.dir</span>, <span class="kw">overwrite</span><span class="kw">=</span><span class="fl">FALSE</span>)</pre></body></html></div>
<p>Confirm you are in the correct directory and it has the required data files:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>()
<span class="co">#&gt;  [1] "CPI.csv"                "ex1_SNEMAYT.dat"        "ex1_test_results.rds"  </span>
<span class="co">#&gt;  [4] "ex2_SNEMAYT.dat"        "ex2_test_results.rds"   "ex4_test_results.rds"  </span>
<span class="co">#&gt;  [7] "ex5_summerflounder.dat" "ex5_test_results.rds"   "ex6_test_results.rds"  </span>
<span class="co">#&gt; [10] "GSI.csv"</span></pre></body></html></div>
<p>Read the ASAP3 .dat file into R and convert to input list for wham:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">asap3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/read_asap3_dat.html">read_asap3_dat</a></span>(<span class="st">"ex2_SNEMAYT.dat"</span>)</pre></body></html></div>
<p>Load the environmental covariate (Cold Pool Index, CPI) data into R:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">env.dat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="st">"CPI.csv"</span>, <span class="kw">header</span><span class="kw">=</span><span class="no">T</span>)</pre></body></html></div>
</div>
<div id="specify-model" class="section level2">
<h2 class="hasAnchor">
<a href="#specify-model" class="anchor"></a>2. Specify model</h2>
<p>Setup model <code>m6</code> from <a href="https://timjmiller.github.io/wham/articles/ex2_CPI_recruitment_SNEMA_yellowtail.html">example 2</a>:</p>
<ul>
<li><p>full state-space model (numbers-at-age are random effects for all ages, <code>NAA_re = list(sigma='rec+1',cor='iid')</code>)</p></li>
<li><p>logistic normal age compositions (<code>input$data$age_comp_model_fleets = 5</code> and <code>input$data$age_comp_model_indices = 5</code>)</p></li>
<li><p>Beverton-Holt recruitment (<code>recruit_model = 3</code>)</p></li>
<li><p>Cold Pool Index (CPI) fit as an AR1 process (<code>ecov$process_model = "ar1"</code>)</p></li>
<li><p>CPI has a "controlling" (density-independent mortality, <a href="https://www.sciencedirect.com/science/article/pii/S1385110197000221">Iles and Beverton (1998)</a>) effect on recruitment (<code>ecov$where = "recruit"</code>, <code>ecov$how = 1</code>)</p></li>
</ul>
<div class="sourceCode"><html><body><pre class="r"><span class="no">env</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="kw">label</span> <span class="kw">=</span> <span class="st">"CPI"</span>,
  <span class="kw">mean</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">env.dat</span>$<span class="no">CPI</span>), <span class="co"># CPI observations</span>
  <span class="kw">logsigma</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">env.dat</span>$<span class="no">CPI_sigma</span>)), <span class="co"># CPI standard error is given/fixed as data</span>
  <span class="kw">year</span> <span class="kw">=</span> <span class="no">env.dat</span>$<span class="no">Year</span>,
  <span class="kw">use_obs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fl">1</span>, <span class="kw">ncol</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">nrow</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">env.dat</span>)[<span class="fl">1</span>]), <span class="co"># use all obs (=1)</span>
  <span class="kw">lag</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="co"># CPI in year t affects recruitment in year t+1</span>
  <span class="kw">process_model</span> <span class="kw">=</span> <span class="st">"ar1"</span>, <span class="co"># fit CPI as AR1 process</span>
  <span class="kw">where</span> <span class="kw">=</span> <span class="st">"recruit"</span>, <span class="co"># CPI affects recruitment</span>
  <span class="kw">how</span> <span class="kw">=</span> <span class="fl">1</span>) <span class="co"># controlling (dens-indep mortality)</span>

<span class="no">input</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/prepare_wham_input.html">prepare_wham_input</a></span>(<span class="no">asap3</span>, <span class="kw">recruit_model</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="co"># Bev-Holt recruitment</span>
                            <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">"Ex 3: Projections"</span>,
                            <span class="kw">ecov</span> <span class="kw">=</span> <span class="no">env</span>,
                            <span class="kw">NAA_re</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">sigma</span><span class="kw">=</span><span class="st">"rec+1"</span>, <span class="kw">cor</span><span class="kw">=</span><span class="st">"iid"</span>))

<span class="co"># age comp: logistic normal pool obs (not multinomial, the default)</span>
<span class="no">input</span>$<span class="no">data</span>$<span class="no">age_comp_model_fleets</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">5</span>, <span class="no">input</span>$<span class="no">data</span>$<span class="no">n_fleets</span>) <span class="co"># 5 = logistic normal (pool zero obs)</span>
<span class="no">input</span>$<span class="no">data</span>$<span class="no">n_age_comp_pars_fleets</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">2</span>)[<span class="no">input</span>$<span class="no">data</span>$<span class="no">age_comp_model_fleets</span>]
<span class="no">input</span>$<span class="no">data</span>$<span class="no">age_comp_model_indices</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">5</span>, <span class="no">input</span>$<span class="no">data</span>$<span class="no">n_indices</span>) <span class="co"># 5 = logistic normal (pool zero obs)</span>
<span class="no">input</span>$<span class="no">data</span>$<span class="no">n_age_comp_pars_indices</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">2</span>)[<span class="no">input</span>$<span class="no">data</span>$<span class="no">age_comp_model_indices</span>]
<span class="no">n_catch_acomp_pars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">2</span>)[<span class="no">input</span>$<span class="no">data</span>$<span class="no">age_comp_model_fleets</span>[<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">input</span>$<span class="no">data</span>$<span class="no">use_catch_paa</span>,<span class="fl">2</span>,<span class="no">sum</span>)<span class="kw">&gt;</span><span class="fl">0</span>)]]
<span class="no">n_index_acomp_pars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">2</span>)[<span class="no">input</span>$<span class="no">data</span>$<span class="no">age_comp_model_indices</span>[<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">input</span>$<span class="no">data</span>$<span class="no">use_index_paa</span>,<span class="fl">2</span>,<span class="no">sum</span>)<span class="kw">&gt;</span><span class="fl">0</span>)]]
<span class="no">input</span>$<span class="no">par</span>$<span class="no">catch_paa_pars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">n_catch_acomp_pars</span>))
<span class="no">input</span>$<span class="no">par</span>$<span class="no">index_paa_pars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">n_index_acomp_pars</span>))

<span class="co"># selectivity = logistic, not age-specific</span>
<span class="co">#   2 pars per block instead of n.ages</span>
<span class="co">#   sel pars of indices 4/5 fixed at 1.5, 0.1 (neg phase in .dat file)</span>
<span class="no">input</span>$<span class="no">par</span>$<span class="no">logit_selpars</span>[<span class="fl">1</span>:<span class="fl">4</span>,<span class="fl">7</span>:<span class="fl">8</span>] <span class="kw">&lt;-</span> <span class="fl">0</span> <span class="co"># original code started selpars at 0 (last 2 rows are fixed)</span></pre></body></html></div>
</div>
<div id="fit-the-model-without-projections" class="section level2">
<h2 class="hasAnchor">
<a href="#fit-the-model-without-projections" class="anchor"></a>3. Fit the model without projections</h2>
<p>You have two options for projecting a WHAM model:</p>
<ol style="list-style-type: decimal">
<li>Fit model without projections and then add projections afterward</li>
</ol>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># don't run</span>
<span class="no">mod</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span>(<span class="no">input</span>) <span class="co"># default do.proj=FALSE</span>
<span class="no">mod_proj</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/project_wham.html">project_wham</a></span>(<span class="no">mod</span>)</pre></body></html></div>
<ol start="2" style="list-style-type: decimal">
<li>Add projections with initial model fit (<code>do.proj = TRUE</code>)</li>
</ol>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># don't run</span>
<span class="no">mod_proj</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span>(<span class="no">input</span>, <span class="kw">do.proj</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p>The two code blocks above are equivalent; when <code>do.proj = TRUE</code>, <code><a href="../reference/fit_wham.html">fit_wham()</a></code> fits the model without projections and then calls <code><a href="../reference/project_wham.html">project_wham()</a></code> to add them. In this example we choose option #1 because we are going to add several different projections to the same model, <code>mod</code>. We will save each projected model in a list, <code>mod_proj</code>.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># run</span>
<span class="no">mod</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/fit_wham.html">fit_wham</a></span>(<span class="no">input</span>)
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(<span class="no">mod</span>, <span class="kw">file</span><span class="kw">=</span><span class="st">"m6.rds"</span>) <span class="co"># save unprojected model</span></pre></body></html></div>
</div>
<div id="add-projections-to-fit-model" class="section level2">
<h2 class="hasAnchor">
<a href="#add-projections-to-fit-model" class="anchor"></a>4. Add projections to fit model</h2>
<p>Projection options are specifed using the <code>proj.opts</code> input to <code><a href="../reference/project_wham.html">project_wham()</a></code>. The default settings are to project 3 years (<code>n.yrs = 3</code>), use average maturity-, weight-, and natural mortality-at-age from last 5 model years to calculate reference points (<code>avg.yrs</code>), use fishing mortality in the last model year (<code>use.last.F = TRUE</code>), and continue the ecov process model (<code>cont.ecov = TRUE</code>). These options are also described in the <code><a href="../reference/project_wham.html">project_wham()</a></code> help page.</p>
<div class="sourceCode"><html><body><pre class="r"> <span class="co"># save projected models in a list</span>
<span class="no">mod_proj</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()

<span class="co"># default settings spelled out</span>
<span class="no">mod_proj</span><span class="kw">[[</span><span class="fl">1</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/project_wham.html">project_wham</a></span>(<span class="no">mod</span>, <span class="kw">proj.opts</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">n.yrs</span><span class="kw">=</span><span class="fl">3</span>, <span class="kw">use.last.F</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">use.avg.F</span><span class="kw">=</span><span class="fl">FALSE</span>,
              <span class="kw">use.FXSPR</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">proj.F</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">proj.catch</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">avg.yrs</span><span class="kw">=</span><span class="kw">NULL</span>,
              <span class="kw">cont.ecov</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">use.last.ecov</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">avg.ecov.yrs</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">proj.ecov</span><span class="kw">=</span><span class="kw">NULL</span>))

<span class="co"># equivalent</span>
<span class="co"># mod_proj[[1]] &lt;- project_wham(mod)</span></pre></body></html></div>
<p>WHAM implements four options for handling the environmental covariate(s) in the projections. Exactly one of these must be specified in <code>proj.opts</code> if <code>ecov</code> is in the model:</p>
<ul>
<li><p>(Default) Continue the ecov process model (e.g. random walk, AR1). Set <code>cont.ecov = TRUE</code>. WHAM will estimate the ecov process in the projection years (i.e. continue the random walk / AR1 process).</p></li>
<li><p>Use last year ecov. Set <code>use.last.ecov = TRUE</code>. WHAM will use ecov value from the terminal year of the population model for projections.</p></li>
<li><p>Use average ecov. Provide <code>avg.yrs.ecov</code>, a vector specifying which years to average over the environmental covariate(s) for projections.</p></li>
<li><p>Specify ecov. Provide <code>proj.ecov</code>, a matrix of user-specified environmental covariate(s) to use for projections. Dimensions must be the number of projection years (<code>proj.opts$n.yrs</code>) x the number of ecovs (<code>ncols(ecov$mean)</code>).</p></li>
</ul>
<p>Note that for all options, <strong>if the original model fit the ecov in years beyond the population model, WHAM will use these already-fit ecov values for the projections</strong>. If the ecov model extended at least <code>proj.opts$n.yrs</code> years beyond the population model, then none of the above need be specified.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># 5 years, use average ecov from 1992-1996</span>
<span class="no">mod_proj</span><span class="kw">[[</span><span class="fl">2</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/project_wham.html">project_wham</a></span>(<span class="no">mod</span>, <span class="kw">proj.opts</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">n.yrs</span><span class="kw">=</span><span class="fl">5</span>, <span class="kw">use.last.F</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">use.avg.F</span><span class="kw">=</span><span class="fl">FALSE</span>,
              <span class="kw">use.FXSPR</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">proj.F</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">proj.catch</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">avg.yrs</span><span class="kw">=</span><span class="kw">NULL</span>,
              <span class="kw">cont.ecov</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">use.last.ecov</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">avg.ecov.yrs</span><span class="kw">=</span><span class="fl">1992</span>:<span class="fl">1996</span>, <span class="kw">proj.ecov</span><span class="kw">=</span><span class="kw">NULL</span>))
<span class="co"># equivalent</span>
<span class="co"># mod_proj[[2]] &lt;- project_wham(mod, proj.opts=list(n.yrs=5, avg.ecov.yrs=1992:1996))</span>

<span class="co"># 5 years, use ecov from last year (2011)</span>
<span class="no">mod_proj</span><span class="kw">[[</span><span class="fl">3</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/project_wham.html">project_wham</a></span>(<span class="no">mod</span>, <span class="kw">proj.opts</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">n.yrs</span><span class="kw">=</span><span class="fl">5</span>, <span class="kw">use.last.F</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">use.avg.F</span><span class="kw">=</span><span class="fl">FALSE</span>,
              <span class="kw">use.FXSPR</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">proj.F</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">proj.catch</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">avg.yrs</span><span class="kw">=</span><span class="kw">NULL</span>,
              <span class="kw">cont.ecov</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">use.last.ecov</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">avg.ecov.yrs</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">proj.ecov</span><span class="kw">=</span><span class="kw">NULL</span>))
<span class="co"># equivalent</span>
<span class="co"># mod_proj[[3]] &lt;- project_wham(mod, proj.opts=list(n.yrs=5, use.last.ecov=TRUE))</span>

<span class="co"># 5 years, specify high CPI ~ 0.5</span>
<span class="co"># note: only need 4 years of CPI because CPI in last model year (2011) was already fit,</span>
<span class="co">#       and CPI affects recruitment with lag = 1. I.e., to project model 5 years (2012-2016),</span>
<span class="co">#       need CPI from 2011-2015 and CPI_2011 already exists in initial model fit.</span>
<span class="no">mod_proj</span><span class="kw">[[</span><span class="fl">4</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/project_wham.html">project_wham</a></span>(<span class="no">mod</span>, <span class="kw">proj.opts</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">n.yrs</span><span class="kw">=</span><span class="fl">5</span>, <span class="kw">use.last.F</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">use.avg.F</span><span class="kw">=</span><span class="fl">FALSE</span>,
              <span class="kw">use.FXSPR</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">proj.F</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">proj.catch</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">avg.yrs</span><span class="kw">=</span><span class="kw">NULL</span>,
              <span class="kw">cont.ecov</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">use.last.ecov</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">avg.ecov.yrs</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">proj.ecov</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>,<span class="fl">0.7</span>,<span class="fl">0.4</span>,<span class="fl">0.5</span>),<span class="kw">ncol</span><span class="kw">=</span><span class="fl">1</span>)))
<span class="co"># equivalent</span>
<span class="co"># mod_proj[[4]] &lt;- project_wham(mod, proj.opts=list(n.yrs=5, proj.ecov=matrix(c(0.5,0.7,0.4,0.5),ncol=1)))</span>

<span class="co"># 5 years, specify low CPI ~ -1.5</span>
<span class="co"># note: again, only need 4 years of CPI because CPI in last model year (2011) was already fit,</span>
<span class="co">#       and CPI affects recruitment with lag = 1. I.e., to project model 5 years (2012-2016),</span>
<span class="co">#       need CPI from 2011-2015 and CPI_2011 already exists in initial model fit.</span>
<span class="no">mod_proj</span><span class="kw">[[</span><span class="fl">5</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/project_wham.html">project_wham</a></span>(<span class="no">mod</span>, <span class="kw">proj.opts</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">n.yrs</span><span class="kw">=</span><span class="fl">5</span>, <span class="kw">use.last.F</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">use.avg.F</span><span class="kw">=</span><span class="fl">FALSE</span>,
              <span class="kw">use.FXSPR</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">proj.F</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">proj.catch</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">avg.yrs</span><span class="kw">=</span><span class="kw">NULL</span>,
              <span class="kw">cont.ecov</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">use.last.ecov</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">avg.ecov.yrs</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">proj.ecov</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">1.6</span>,-<span class="fl">1.3</span>,-<span class="fl">1</span>,-<span class="fl">1.2</span>),<span class="kw">ncol</span><span class="kw">=</span><span class="fl">1</span>)))
<span class="co"># equivalent</span>
<span class="co"># mod_proj[[5]] &lt;- project_wham(mod, proj.opts=list(n.yrs=5, proj.ecov=matrix(c(-1.6,-1.3,-1,-1.2),ncol=1)))</span></pre></body></html></div>
<p>WHAM implements five options for handling fishing mortality in the projections. Exactly one of these must be specified in <code>proj.opts</code>:</p>
<ul>
<li><p>(Default) Use last year F. Set <code>use.last.F = TRUE</code>. WHAM will use F in the terminal model year for projections.</p></li>
<li><p>Use average F. Set <code>use.avg.F = TRUE</code>. WHAM will use F averaged over <code>proj.opts$avg.yrs</code> for projections (as is done for M-, maturity-, and weight-at-age).</p></li>
<li><p>Use F at X% SPR. Set <code>use.FXSPR = TRUE</code>. WHAM will calculate and apply F at X% SPR, where X was set by <code>input$data$percentSPR</code> (default = 40%).</p></li>
<li><p>Specify F. Provide <code>proj.F</code>, an F vector with length = <code>proj.opts$n.yrs</code>.</p></li>
<li><p>Specify catch. Provide <code>proj.catch</code>, a vector of aggregate catch with length = <code>proj.opts$n.yrs</code>. WHAM will calculate F across fleets to apply the specified catch.</p></li>
</ul>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># 5 years, specify catch</span>
<span class="no">mod_proj</span><span class="kw">[[</span><span class="fl">6</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/project_wham.html">project_wham</a></span>(<span class="no">mod</span>, <span class="kw">proj.opts</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">n.yrs</span><span class="kw">=</span><span class="fl">5</span>, <span class="kw">use.last.F</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">use.avg.F</span><span class="kw">=</span><span class="fl">FALSE</span>,
              <span class="kw">use.FXSPR</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">proj.F</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">proj.catch</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">10</span>, <span class="fl">2000</span>, <span class="fl">1000</span>, <span class="fl">3000</span>, <span class="fl">20</span>), <span class="kw">avg.yrs</span><span class="kw">=</span><span class="kw">NULL</span>,
              <span class="kw">cont.ecov</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">use.last.ecov</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">avg.ecov.yrs</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">proj.ecov</span><span class="kw">=</span><span class="kw">NULL</span>))
<span class="co"># equivalent</span>
<span class="co"># mod_proj[[6]] &lt;- project_wham(mod, proj.opts=list(n.yrs=5, proj.catch=c(10, 2000, 1000, 3000, 20)))</span>

<span class="co"># 5 years, specify F</span>
<span class="no">mod_proj</span><span class="kw">[[</span><span class="fl">7</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/project_wham.html">project_wham</a></span>(<span class="no">mod</span>, <span class="kw">proj.opts</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">n.yrs</span><span class="kw">=</span><span class="fl">5</span>, <span class="kw">use.last.F</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">use.avg.F</span><span class="kw">=</span><span class="fl">FALSE</span>,
              <span class="kw">use.FXSPR</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">proj.F</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.001</span>, <span class="fl">1</span>, <span class="fl">0.5</span>, <span class="fl">.1</span>, <span class="fl">.2</span>), <span class="kw">proj.catch</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">avg.yrs</span><span class="kw">=</span><span class="kw">NULL</span>,
              <span class="kw">cont.ecov</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">use.last.ecov</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">avg.ecov.yrs</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">proj.ecov</span><span class="kw">=</span><span class="kw">NULL</span>))
<span class="co"># equivalent</span>
<span class="co"># mod_proj[[7]] &lt;- project_wham(mod, proj.opts=list(n.yrs=5, proj.F=c(0.001, 1, 0.5, .1, .2)))</span>

<span class="co"># 5 years, use FXSPR</span>
<span class="no">mod_proj</span><span class="kw">[[</span><span class="fl">8</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/project_wham.html">project_wham</a></span>(<span class="no">mod</span>, <span class="kw">proj.opts</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">n.yrs</span><span class="kw">=</span><span class="fl">5</span>, <span class="kw">use.last.F</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">use.avg.F</span><span class="kw">=</span><span class="fl">FALSE</span>,
              <span class="kw">use.FXSPR</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">proj.F</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">proj.catch</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">avg.yrs</span><span class="kw">=</span><span class="kw">NULL</span>,
              <span class="kw">cont.ecov</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">use.last.ecov</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">avg.ecov.yrs</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">proj.ecov</span><span class="kw">=</span><span class="kw">NULL</span>))
<span class="co"># equivalent</span>
<span class="co"># mod_proj[[8]] &lt;- project_wham(mod, proj.opts=list(n.yrs=5, use.FXSPR=TRUE))</span>

<span class="co"># 3 years, use avg F (avg.yrs defaults to last 5 years, 2007-2011)</span>
<span class="no">mod_proj</span><span class="kw">[[</span><span class="fl">9</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/project_wham.html">project_wham</a></span>(<span class="no">mod</span>, <span class="kw">proj.opts</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">n.yrs</span><span class="kw">=</span><span class="fl">3</span>, <span class="kw">use.last.F</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">use.avg.F</span><span class="kw">=</span><span class="fl">TRUE</span>,
              <span class="kw">use.FXSPR</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">proj.F</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">proj.catch</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">avg.yrs</span><span class="kw">=</span><span class="kw">NULL</span>,
              <span class="kw">cont.ecov</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">use.last.ecov</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">avg.ecov.yrs</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">proj.ecov</span><span class="kw">=</span><span class="kw">NULL</span>))
<span class="co"># equivalent</span>
<span class="co"># mod_proj[[9]] &lt;- project_wham(mod, proj.opts=list(use.avg.F=TRUE))</span>

<span class="co"># 10 years, use avg F 1992-1996</span>
<span class="no">mod_proj</span><span class="kw">[[</span><span class="fl">10</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/project_wham.html">project_wham</a></span>(<span class="no">mod</span>, <span class="kw">proj.opts</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">n.yrs</span><span class="kw">=</span><span class="fl">10</span>, <span class="kw">use.last.F</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">use.avg.F</span><span class="kw">=</span><span class="fl">TRUE</span>,
              <span class="kw">use.FXSPR</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">proj.F</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">proj.catch</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">avg.yrs</span><span class="kw">=</span><span class="fl">1992</span>:<span class="fl">1996</span>,
              <span class="kw">cont.ecov</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">use.last.ecov</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">avg.ecov.yrs</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">proj.ecov</span><span class="kw">=</span><span class="kw">NULL</span>))
<span class="co"># equivalent</span>
<span class="co"># mod_proj[[10]] &lt;- project_wham(mod, proj.opts=list(n.yrs=10, use.avg.F=TRUE, avg.yrs=1992:1996))</span></pre></body></html></div>
<p>Save projected models</p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(<span class="no">mod_proj</span>, <span class="kw">file</span><span class="kw">=</span><span class="st">"m6_proj.rds"</span>)</pre></body></html></div>
</div>
<div id="compare-projections" class="section level2">
<h2 class="hasAnchor">
<a href="#compare-projections" class="anchor"></a>5. Compare projections</h2>
<p>Projecting the model differently should not have changed the marginal negative log-likelihood! Confirm that the NLL is the same for all projected models (within <code>1e-06</code>).</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">mod</span>$<span class="no">opt</span>$<span class="no">obj</span> <span class="co"># original model NLL</span></pre></body></html></div>
<pre><code>#&gt; [1] -824.6358
#&gt; attr(,"logarithm")
#&gt; [1] TRUE</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="no">nll_proj</span> <span class="kw">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">mod_proj</span>, <span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span>$<span class="no">opt</span>$<span class="no">obj</span>) <span class="co"># projected models NLL</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">nll_proj</span> - <span class="no">mod</span>$<span class="no">opt</span>$<span class="no">obj</span>, <span class="fl">6</span>) <span class="co"># difference between original and projected models' NLL</span></pre></body></html></div>
<pre><code>#&gt;  [1] 0 0 0 0 0 0 0 0 0 0</code></pre>
<p>Now let's plot results from each of the projected models.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="kw">for</span>(<span class="no">m</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">mod_proj</span>)){
  <span class="fu"><a href="../reference/plot_wham_output.html">plot_wham_output</a></span>(<span class="no">mod_proj</span><span class="kw">[[</span><span class="no">m</span>]], <span class="kw">dir.main</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"proj_"</span>,<span class="no">m</span>)), <span class="kw">out.type</span><span class="kw">=</span><span class="st">'html'</span>)
}</pre></body></html></div>
<p>To more easily compare the same plots for each projection, copy plots into new folders organized by plot type instead of model.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">plots</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Ecov_1"</span>,<span class="st">"F_byfleet"</span>,<span class="st">"SSB_at_age"</span>,<span class="st">"SSB_F_trend"</span>,<span class="st">"SSB_Rec_time"</span>,<span class="st">"Kobe_status"</span>)
<span class="no">dirs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="no">plots</span>)
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="no">dirs</span>), <span class="kw">FUN</span><span class="kw">=</span><span class="no">dir.create</span>)
<span class="kw">for</span>(<span class="no">m</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">mod_proj</span>)){
  <span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">plots</span>)){
     <span class="fu"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span>(<span class="kw">from</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"proj_"</span>,<span class="no">m</span>),<span class="st">"plots_png"</span>,<span class="st">"results"</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">plots</span>[<span class="no">i</span>],<span class="st">".png"</span>)),
               <span class="kw">to</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">dirs</span>[<span class="no">i</span>],<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">plots</span>[<span class="no">i</span>],<span class="st">"_proj_"</span>,<span class="no">m</span>,<span class="st">".png"</span>)))
     <span class="fu"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span>(<span class="kw">from</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"proj_"</span>,<span class="no">m</span>),<span class="st">"plots_png"</span>,<span class="st">"ref_points"</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">plots</span>[<span class="no">i</span>],<span class="st">".png"</span>)),
               <span class="kw">to</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">dirs</span>[<span class="no">i</span>],<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">plots</span>[<span class="no">i</span>],<span class="st">"_proj_"</span>,<span class="no">m</span>,<span class="st">".png"</span>)))
  }
}</pre></body></html></div>
</div>
<div id="results" class="section level2">
<h2 class="hasAnchor">
<a href="#results" class="anchor"></a>6. Results</h2>
<div id="projected-cpi" class="section level3">
<h3 class="hasAnchor">
<a href="#projected-cpi" class="anchor"></a>Projected CPI</h3>
<p><img src="https://raw.githubusercontent.com/timjmiller/wham/master/vignettes/ex3_plots/Ecov_1_proj_1.png" alt="Projected CPI, 3 years, continue AR1 process." style="width:30.0%"><img src="https://raw.githubusercontent.com/timjmiller/wham/master/vignettes/ex3_plots/Ecov_1_proj_2.png" alt="Projected CPI, 5 years, use average Ecov from 1992-1996." style="width:30.0%"><img src="https://raw.githubusercontent.com/timjmiller/wham/master/vignettes/ex3_plots/Ecov_1_proj_3.png" alt="Projected CPI, 5 years, use Ecov from last year (2011)." style="width:30.0%"></p>
<p><img src="https://raw.githubusercontent.com/timjmiller/wham/master/vignettes/ex3_plots/Ecov_1_proj_4.png" alt="Projected CPI, 5 years, specify high CPI ~ 0.5." style="width:30.0%"><img src="https://raw.githubusercontent.com/timjmiller/wham/master/vignettes/ex3_plots/Ecov_1_proj_5.png" alt="5 years, specify low CPI ~ -1.5." style="width:30.0%"></p>
</div>
<div id="projected-f-catch" class="section level3">
<h3 class="hasAnchor">
<a href="#projected-f-catch" class="anchor"></a>Projected F / catch</h3>
<p><img src="https://raw.githubusercontent.com/timjmiller/wham/master/vignettes/ex3_plots/SSB_F_trend_proj_6.png" alt="5 years, specify catch." style="width:30.0%"><img src="https://raw.githubusercontent.com/timjmiller/wham/master/vignettes/ex3_plots/SSB_F_trend_proj_7.png" alt="5 years, specify F." style="width:30.0%"><img src="https://raw.githubusercontent.com/timjmiller/wham/master/vignettes/ex3_plots/SSB_F_trend_proj_8.png" alt="5 years, use FXSPR." style="width:30.0%"></p>
<p><img src="https://raw.githubusercontent.com/timjmiller/wham/master/vignettes/ex3_plots/SSB_F_trend_proj_9.png" alt="3 years, use avg F over last 5 years (2007-2011)." style="width:30.0%"><img src="https://raw.githubusercontent.com/timjmiller/wham/master/vignettes/ex3_plots/SSB_F_trend_proj_10.png" alt="10 years, use avg F 1992-1996." style="width:30.0%"></p>
</div>
<div id="stock-status" class="section level3">
<h3 class="hasAnchor">
<a href="#stock-status" class="anchor"></a>Stock status</h3>
<p>In the stock status (Kobe) plots of the projected models, the final model year is in bold and the final projected year is not bold.</p>
<p><img src="https://raw.githubusercontent.com/timjmiller/wham/master/vignettes/ex3_plots/Kobe_status_proj_1.png" alt="Stock status, projection 1." style="width:45.0%"><img src="https://raw.githubusercontent.com/timjmiller/wham/master/vignettes/ex3_plots/Kobe_status_proj_2.png" alt="Stock status, projection 2." style="width:45.0%"></p>
<p><img src="https://raw.githubusercontent.com/timjmiller/wham/master/vignettes/ex3_plots/Kobe_status_proj_3.png" alt="Stock status, projection 3." style="width:45.0%"><img src="https://raw.githubusercontent.com/timjmiller/wham/master/vignettes/ex3_plots/Kobe_status_proj_4.png" alt="Stock status, projection 4." style="width:45.0%"></p>
<p><img src="https://raw.githubusercontent.com/timjmiller/wham/master/vignettes/ex3_plots/Kobe_status_proj_5.png" alt="Stock status, projection 5." style="width:45.0%"><img src="https://raw.githubusercontent.com/timjmiller/wham/master/vignettes/ex3_plots/Kobe_status_proj_6.png" alt="Stock status, projection 6." style="width:45.0%"></p>
<p><img src="https://raw.githubusercontent.com/timjmiller/wham/master/vignettes/ex3_plots/Kobe_status_proj_7.png" alt="Stock status, projection 7." style="width:45.0%"><img src="https://raw.githubusercontent.com/timjmiller/wham/master/vignettes/ex3_plots/Kobe_status_proj_8.png" alt="Stock status, projection 8." style="width:45.0%"></p>
<p><img src="https://raw.githubusercontent.com/timjmiller/wham/master/vignettes/ex3_plots/Kobe_status_proj_9.png" alt="Stock status, projection 9." style="width:45.0%"><img src="https://raw.githubusercontent.com/timjmiller/wham/master/vignettes/ex3_plots/Kobe_status_proj_10.png" alt="Stock status, projection 10." style="width:45.0%"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Tim Miller, Brian Stock.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
